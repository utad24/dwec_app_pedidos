<div class="w-full">
  <div class="w-full">
    <div class="flex flex-col">
      <div class="mb-4">
        <h1 class="text-2xl font-semibold leading-tight text-gray-900">Pedidos</h1>
      </div>
      <div class="py-4 flex flex-wrap flex-grow justify-end">
        <div class="flex items-center py-2">
          <a routerLink="/admin/orders/new"
             class="inline-flex items-center justify-center whitespace-nowrap rounded-xl text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 bg-slate-950 text-white shadow hover:bg-slate-900/90 px-6 py-3">
            Crear nuevo pedido
          </a>
        </div>
      </div>
      <div class="">
        <div class="align-middle inline-block w-full border overflow-x-auto sm:rounded-lg border-b border-gray-200">
          <table class="min-w-full bg-white">
            <!-- HEAD start -->
            <thead>
              <tr class=" border-b border-gray-200 text-xs leading-4 text-slate-500 uppercase tracking-wider">
                <th class="px-6 py-3 text-left font-medium">
                  Nombre
                </th>
                <th class="px-6 py-3 text-left font-medium">
                  Productos
                </th>
                <th class="px-6 py-3 text-left font-medium">
                  Estado
                </th>
                <th class="px-6 py-3 text-left font-medium">
                  Created
                </th>
                <th class="px-6 py-3 text-left font-medium">
                </th>
              </tr>
            </thead>
            <!-- HEAD end -->
            <!-- BODY start -->
            <tbody class="bg-white">
              @for (order of orders; track order.id) {
              <tr>
                <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200">
                  <div class="text-sm leading-5 text-gray-900">
                    {{order?.userData?.fullName}}
                  </div>
                </td>
                
                <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200">
                  <div class="text-sm leading-5 text-gray-900">
                    {{order?.products?.length ?? 0}} Productos
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200">
                  @switch (order.orderStatus) {
                    @case ('pending') {
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                        Pendiente
                      </span>
                    }
                    @case ('delivered') {
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                        Entregado
                      </span>
                    }
                    @case ('shipped') {
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                        Enviado
                      </span>
                    }
                    @case ('refunded') {
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                        Reembolsado
                      </span>
                    }
                    @default {
                      <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                        Desconocido
                      </span>
                    }
                  }
                </td>
                <td class="px-6 py-4 whitespace-no-wrap border-b border-gray-200 text-sm leading-5 text-gray-500">
                  {{order?.createdAt | date}}
                </td>
                <td class="px-6 py-4 whitespace-no-wrap text-right border-b border-gray-200 text-sm leading-5 font-medium">
                  <div class="inline-flex">
                      <button (click)="updateOrder(order)"
                      class="inline-flex items-center justify-center text-center text-indigo-600 hover:text-indigo-900 focus:outline-none focus:underline bg-indigo-100 px-3 py-2 rounded-md hover:bg-indigo-200" >
                     Actualizar pedido
                   </button>
                   <button (click)="deleteOrder(order)"
                      class="inline-flex items-center justify-center text-center text-red-600 hover:text-red-900 focus:outline-none focus:underline bg-red-100 px-3 py-2 rounded-md hover:bg-red-200 ml-2" >
                     Eliminar
                   </button>
                  </div>
                </td>
              </tr>
              }

            </tbody>
            <!-- BODY end -->
          </table>
        </div>
      </div>
    </div>
  </div>
</div>


@if (alertData.show && alertData.action == 'delete') {
<confirmation-dialog [data]="alertData" (accept)="makeAction()" (cancel)="cancelAction()"></confirmation-dialog>
}

@if (alertData.show && alertData.action == 'status') {
<status-dialog [currentStatus]="orderSelected?.orderStatus ?? ''" [data]="alertData" (accept)="updateStatus($event)" (cancel)="cancelAction()"></status-dialog>
}
